<Window x:Class="Screen_Recorder.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ISURU's SR"
        Height="700"
        Width="1280"
        MinWidth="1000"
        MinHeight="600"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Background="{DynamicResource App.Background}" Icon="/bd-removebg-preview (1).png">

    <Window.Resources>
        <!-- Theme -->
        <LinearGradientBrush x:Key="App.Background" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0B1016" Offset="0"/>
            <GradientStop Color="#101627" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="HeaderGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#4F46E5" Offset="0"/>
            <GradientStop Color="#06B6D4" Offset="1"/>
        </LinearGradientBrush>

        <SolidColorBrush x:Key="Card.Background" Color="#111827"/>
        <SolidColorBrush x:Key="Card.Border" Color="#1F2937"/>
        <SolidColorBrush x:Key="Accent" Color="#06B6D4"/>
        <SolidColorBrush x:Key="Text.Primary" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="Text.Secondary" Color="#9CA3AF"/>

        <!-- Typography -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource Text.Primary}"/>
        </Style>

        <!-- Buttons -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Margin" Value="8,0,0,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#10b981" Offset="0"/>
                        <GradientStop Color="#059669" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#ef4444" Offset="0"/>
                        <GradientStop Color="#dc2626" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="NeutralButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="{DynamicResource HeaderGradient}"/>
        </Style>

        <!-- Readable ComboBox (black text on white) -->
        <Style TargetType="ComboBox">
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Card.Border}"/>
            <Setter Property="Margin" Value="6,0,0,0"/>
            <Setter Property="MinWidth" Value="220"/>
            <Setter Property="Padding" Value="6,4"/>
        </Style>
        <Style TargetType="ComboBoxItem">
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Background" Value="White"/>
        </Style>

        <!-- Inputs -->
        <Style TargetType="TextBox">
            <Setter Property="Foreground" Value="{DynamicResource Text.Primary}"/>
            <Setter Property="Background" Value="#0F172A"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Card.Border}"/>
            <Setter Property="Margin" Value="6,0,0,0"/>
            <Setter Property="Padding" Value="6,4"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource Text.Primary}"/>
            <Setter Property="Margin" Value="6,0,0,0"/>
        </Style>

        <!-- Card -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Background" Value="{DynamicResource Card.Background}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Card.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#000000" BlurRadius="10" ShadowDepth="1" Opacity="0.35"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Add this converter -->
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border CornerRadius="10" Background="{DynamicResource HeaderGradient}" Padding="16" Margin="0,0,0,12">
            <DockPanel LastChildFill="False">
                <!-- Title + Subtitle (left) -->
                <StackPanel DockPanel.Dock="Left">
                    <TextBlock Text="ISURU's SR" FontSize="22" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Modern Best Screen Recoder" Foreground="#E6FFFFFF" FontSize="12" Margin="0,2,0,0"/>
                </StackPanel>

                <!-- Status (right) | Removed header Start/Stop buttons -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center">
                    <TextBlock Text="{Binding Status}" Foreground="White" Margin="0,0,12,0" VerticalAlignment="Center"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Capture -->
        <Border Grid.Row="1" Style="{StaticResource Card}">
            <StackPanel>
                <TextBlock Text="Capture" FontWeight="Bold" Foreground="{DynamicResource Accent}" Margin="0,0,0,8"/>

                <WrapPanel>
                    <TextBlock Text="Source:" VerticalAlignment="Center"/>
                    <!-- Bind to SelectedCaptureSource so VM can react -->
                    <ComboBox x:Name="combo1"
                              SelectedItem="{Binding SelectedCaptureSource}"
                              ItemsSource="{Binding CaptureSources}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <TextBlock Text="Monitor:" VerticalAlignment="Center" Margin="12,0,0,0"/>
                    <ComboBox x:Name="combo2" Width="260" SelectedItem="{Binding SelectedMonitor}" ItemsSource="{Binding Monitors}" DisplayMemberPath="DisplayName"/>
                    <CheckBox Content="Include Cursor" IsChecked="{Binding Settings.IncludeCursor}" Margin="12,0,0,0"/>
                </WrapPanel>

                <!-- Window picker (only when Source = WindowTitle) -->
                <WrapPanel Margin="0,8,0,0"
                           Visibility="{Binding IsWindowTitleSource, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Window:" VerticalAlignment="Center"/>
                    <ComboBox Width="520"
                              ItemsSource="{Binding RunningWindows}"
                              SelectedItem="{Binding Settings.WindowTitle}"/>
                    <Button Style="{StaticResource NeutralButton}" Content="Refresh" Command="{Binding RefreshWindowsCommand}"/>
                </WrapPanel>

                <!-- Region fields (only when Source = Region) -->
                <WrapPanel Margin="0,8,0,0"
                           Visibility="{Binding IsRegionSource, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Region:" VerticalAlignment="Center"/>
                    <TextBox Width="60" Text="{Binding Settings.RegionX}" ToolTip="X"/>
                    <TextBox Width="60" Text="{Binding Settings.RegionY}" ToolTip="Y"/>
                    <TextBox Width="80" Text="{Binding Settings.RegionWidth}" ToolTip="W"/>
                    <TextBox Width="80" Text="{Binding Settings.RegionHeight}" ToolTip="H"/>
                    <TextBlock Text="FPS:" VerticalAlignment="Center" Margin="12,0,0,0"/>
                    <TextBox Width="60" Text="{Binding Settings.FPS}"/>
                </WrapPanel>

                <WrapPanel Margin="0,8,0,0">
                    <TextBlock Text="Encoder:" VerticalAlignment="Center"/>
                    <ComboBox Width="360" ItemsSource="{Binding Encoders}" SelectedItem="{Binding Settings.VideoEncoder}"/>
                    <TextBlock Text="Quality:" VerticalAlignment="Center" Margin="12,0,0,0"/>
                    <ComboBox Width="160" ItemsSource="{Binding QualityLevels}" SelectedItem="{Binding Settings.QualityLevel}"/>
                </WrapPanel>
            </StackPanel>
        </Border>

        <!-- Output + Audio -->
        <Border Grid.Row="2" Style="{StaticResource Card}">
            <DockPanel LastChildFill="True">
                <StackPanel DockPanel.Dock="Top">
                    <TextBlock Text="Audio" FontWeight="Bold" Foreground="{DynamicResource Accent}"/>
                    <WrapPanel Margin="0,8,0,8">
                        <CheckBox Content="Record System Audio" IsChecked="{Binding Settings.RecordSystemAudio}"/>
                        <CheckBox Content="Record Microphone" IsChecked="{Binding Settings.RecordMicrophone}" Margin="12,0,0,0"/>
                    </WrapPanel>

                    <TextBlock Text="Output" FontWeight="Bold" Foreground="{DynamicResource Accent}" Margin="0,8,0,0"/>
                    <WrapPanel Margin="0,8,0,0">
                        <TextBlock Text="Folder:" VerticalAlignment="Center"/>
                        <TextBox Width="520" Text="{Binding Settings.OutputFolder}"/>
                        <Button Style="{StaticResource NeutralButton}" Content="Browse…" Command="{Binding BrowseOutputCommand}"/>
                        <TextBlock Text="File Name:" VerticalAlignment="Center" Margin="12,0,0,0"/>
                        <TextBox Width="260" Text="{Binding Settings.OutputFileNamePattern}" ToolTip="Recording_{yyyyMMdd_HHmmss}.mp4"/>
                    </WrapPanel>
                </StackPanel>

                <!-- Log -->
                <TextBox Margin="0,12,0,0"
                         Height="220"
                         IsReadOnly="True"
                         VerticalScrollBarVisibility="Auto"
                         Text="{Binding Log}"
                         Background="#0B1220"
                         Foreground="{DynamicResource Text.Secondary}"/>
            </DockPanel>
        </Border>

        <!-- Bottom Controls -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,8,0,0">
            <Button Style="{StaticResource PrimaryButton}" Content="Start" Width="160" Command="{Binding StartCommand}" IsEnabled="{Binding CanStart}"/>
            <Button Style="{StaticResource NeutralButton}" Content="Pause" Width="160" Command="{Binding PauseCommand}" IsEnabled="{Binding IsRecording}"/>
            <Button Style="{StaticResource NeutralButton}" Content="Resume" Width="160" Command="{Binding ResumeCommand}" IsEnabled="{Binding IsPaused}"/>
            <Button Style="{StaticResource DangerButton}" Content="Stop" Width="160" Command="{Binding StopCommand}" IsEnabled="{Binding IsRecording}"/>
        </StackPanel>

        <!-- Watermark -->
        <TextBlock Text="created by isuru sampath"
                   Foreground="#66FFFFFF"
                   FontStyle="Italic"
                   FontSize="12"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Bottom"
                   Margin="0,0,19,12"
                   IsHitTestVisible="False"/>
    </Grid>
</Window>